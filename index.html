<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.10/vue.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.0/axios.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
            crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css"
          integrity="sha384-b6lVK+yci+bfDmaY1u0zE8YYJt0TZxLEAFyYSLHId4xoVvsrQu3INevFKo+Xir8e" crossorigin="anonymous">
    <title>Title</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=FAMILY_NAME:wght@WEIGHT_OR_RANGE&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        h1 {
            margin-top: 30px;
            margin-bottom: 10px;
        }

        p {
            margin: auto;
        }

        body {

            font-family: 'Montserrat', sans-serif;
            font-weight: 200;
            color: var(--tg-theme-text-color);
            background: var(--tg-theme-bg-color);
        }

        #main {
            width: 100%;
            padding: 20px;
            text-align: center;
            position: sticky;
            top: 0;
            background: var(--tg-theme-bg-color);
            opacity: 0.99;
            z-index: 999;
        }

        #nav-tabs {
            width: 100%;
            padding-left: 20px;
            padding-right: 20px;
            text-align: center;
        }

        #main_data {
            width: 100%;
            padding: 20px;
            text-align: center;
        }

        #main_card {
            width: 100%;
            padding: 20px;
            text-align: center;
        }

        input {
            color: var(--tg-theme-button-color);
            background: var(--tg-theme-button-text-color);
        }


        .mt-1, .my-1 {
            margin-top: .25rem !important;
        }

        .mt-3, .my-3 {
            margin-top: 1rem !important;
        }

        .mb-0, .my-0 {
            margin-bottom: 0 !important;
        }

        .mb-3, .my-3 {
            margin-bottom: 1rem !important;
            margin-left: 0.1rem !important;
            margin-right: 0.1rem !important;
        }

        .h5, h5 {
            font-size: 1.25rem;
        }

        .h1, .h2, .h3, .h4, .h5, .h6, h1, h2, h3, h4, h5, h6 {
            margin-bottom: .5rem;
            font-family: inherit;
            font-weight: 500;
            line-height: 1.2;
            color: inherit;
        }

        h1, h2, h3, h4, h5, h6 {
            margin-top: 0;
            margin-bottom: .5rem;
        }


        a {
            color: var(--tg-theme-text-color);
        }

        a:hover {
            color: var(--tg-theme-text-color);
        }

        .card {
            margin-bottom: 30px;
            -webkit-box-shadow: 2px 2px 2px rgba(0, 0, 0, 0.1), -1px 0 2px rgba(0, 0, 0, 0.05);
            box-shadow: 2px 2px 2px rgba(0, 0, 0, 0.1), -1px 0 2px rgba(0, 0, 0, 0.05);

            /*background-color: var(--tg-theme-secondary-bg-color);*/
            background: var(--tg-theme-secondary-bg-color);
            background: linear-gradient(180deg, var(--tg-theme-secondary-bg-color) 80%, var(--tg-theme-button-color) 100%);

            border: 0 solid #eee;
            border-radius: 5px;

            position: relative;
            display: -ms-flexbox;
            display: flex;
            -ms-flex-direction: column;
            flex-direction: column;
            min-width: 0;
            word-wrap: break-word;
            background-clip: border-box;
        }

        .star-favs {
            border: unset;
            /*border-color: var(--tg-theme-secondary-bg-color);*/
            /*border-radius: 5px;*/
            /*margin: 50px;*/
            padding: 5px;
            height: 40px;
            /*width: 160px;*/
            font-size: 20px;
            font-style: oblique;
            font-weight: 200;
            cursor: pointer;
            /*transition: all 500ms ease;*/
            color: var(--tg-theme-button-text-color);
            /*background: var(--tg-theme-button-text-color);*/
        }


        .card-body {
            padding: 1.25rem;
            -ms-flex: 1 1 auto;
            flex: 1 1 auto;
        }

        .align-items-center {
            -ms-flex-align: center !important;
            align-items: center !important;
        }

        .media {
            flex-flow: column;
            display: -ms-flexbox;
            display: flex;
            -ms-flex-align: start;
            align-items: flex-start;
        }

        .avatar.avatar-xl {
            width: 5rem;
            height: 5rem;
        }

        .avatar {
            width: 2rem;
            height: 2rem;
            line-height: 2rem;
            border-radius: 50%;
            display: inline-block;
            background: #ced4da no-repeat center/cover;
            position: relative;
            text-align: center;
            color: #868e96;
            font-weight: 600;
            vertical-align: bottom;
        }

        .mr-3, .mx-3 {
            margin-right: 1rem !important;
        }


        .text-muted {
            color: var(--tg-theme-button-color);
        }

        .text-uppercase {
            text-transform: uppercase !important;
        }

        .card-text a {
            color: var(--tg-theme-text-color);
        }

        .card-text:last-child {
            margin-bottom: 0;
        }

        abbr[data-original-title], abbr[title] {
            text-decoration: underline;
            -webkit-text-decoration: underline dotted;
            text-decoration: underline dotted;
            cursor: help;
            border-bottom: 0;
        }
        .btn_search:hover {
            color: var(--tg-theme-button-color);
        }
    </style>
</head>
<body id="all_data">

<div id="app">
    <div id="nav-tabs" class="text-center">
        <input type="checkbox" class="btn-check" id="aria-link" autocomplete="off" value=true
               v-model="aria_link"
               @change="getUserData()">
        <label class="nav nav-tabs nav-justified" for="aria-link">
            <div class="nav-item d-flex align-items-center ">
                <i v-show="!aria_link" class="nav-link active h1 bi bi-person-lines-fill">Профиль</i>
                <i v-show="!aria_link" class="nav-link h1 text-muted bi bi-people-fill">Контакты</i>

                <i v-show="aria_link" class="nav-link h1 text-muted bi bi-person-lines-fill">Профиль</i>
                <i v-show="aria_link" class="nav-link active h1 bi bi-people-fill">Контакты</i>
            </div>
        </label>
    </div>
    <div v-show="!aria_link" id="main_card">
        <div class="card" v-for="user_one in user_info" v-bind:value="user_one.name">
            <div class="card-body">
                <div class="media">
                    <div class="d-flex">
                        <div class="text-start">
                            <h5 class="card-text"> {{ user_one.name }} </h5>
                            <p class="card-text text-uppercase">
                                <b>Департамент: </b> {{ user_one.organization }}
                            </p>
                        </div>
                        <div>
                            <img v-show="(user_one.photo).length > 10" class="avatar avatar-xl mb-3"
                                 v-bind:src="'data:image/png;base64,'+user_one.photo" alt=".... ФОТО">
                            <span v-show="(user_one.photo).length < 10"
                                  style="background-image: url(https://img.icons8.com/ios/100/user--v1.png)"
                                  class="avatar avatar-xl mb-3">
                        </span>
                        </div>
                    </div>
                    <div class="media-body overflow-hidden text-start">
                        <p class="card-text">
                            <b>Должность: </b> {{ user_one.position }}
                        </p>
                        <p class="card-text">
                            <span title="Phone">Email:</span>
                            <a href="mailto:{{ user_one.email }}"> {{ user_one.email }}</a>
                        </p>
                        <p class="card-text">
                            <span title="Phone">Телефон: </span>
                            <a href="tel:{{ user_one.phone_mobile }}"> {{ user_one.phone_mobile }}</a>
                        </p>
                        <p class="card-text">
                            <span title="Phone">Телефон ВН: </span>
                            <a href="tel:{{ user_one.phone_internal }}">{{ user_one.phone_internal }}</a>
                        </p>
                        <p class="card-text">
                            <b>Персональная информация: - - - -</b>
                            <a href="tel:+79626281225">Позвонить</a>
                        </p>
                        <p class="card-text">
                            <b>Дни отпуска: - - - -</b>
                        </p>
                        <p class="card-text">
                            <b>Задачи: - - - -</b>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div v-show="aria_link">
        <div id="main">
            <div class="input-group">
                <input type="checkbox" class="btn-check" id="btn-checks" autocomplete="off" value=true
                       v-model="checked"
                       @change="getUserData()">
                <label class="p-1 mx-3" for="btn-checks">
                    <i v-show="!checked" class="h1 bi bi-star"></i>
                    <i v-show="checked" class="h1 bi bi-star-fill"></i>
                </label>

                    <input type="text" class="form-control rounded-start border-dark border-end-0"
                           placeholder="  Поиск контактов" aria-label="Recipient's username"
                           aria-describedby="button-search"
                           v-model="query" @change="getUserData()">
                    <button class="btn btn_search btn-outline-white border-dark border-start-0 text-dark"
                            type="button" id="button-search">
                        <i class="h1 bi bi-search"></i>
                    </button>

            </div>
        </div>
        <div id="main_data">
            <div class="card" v-for="exo in u_Data" v-bind:value="exo.favs">
                <div class="card-body">
                    <div class="media">
                        <div class="d-flex">
                            <div class="text-start">
                                <h5 class="card-text"> {{ exo.name }} </h5>
                                <p class="card-text text-uppercase">
                                    <b>Департамент: </b> {{ exo.organization }}
                                </p>
                            </div>
                            <div>
                                <img v-show="(exo.photo).length > 10" class="avatar avatar-xl mb-3"
                                     v-bind:src="'data:image/png;base64,'+exo.photo" alt=".... ФОТО">
                                <span v-show="(exo.photo).length < 10"
                                      style="background-image: url(https://img.icons8.com/ios/100/user--v1.png)"
                                      class="avatar avatar-xl mb-3">
                        </span>
                            </div>
                        </div>
                        <div class="media-body overflow-hidden text-start">
                            <p class="card-text">
                                <b>Должность: </b> {{ exo.position }}
                            </p>
                            <p class="card-text">
                                <span title="Phone">Email: </span>
                                <a v-bind:value="exo.email" href="mailto:exo.email" v-model="set_data">{{ exo.email
                                    }}</a>
                            </p>
                            <p class="card-text">
                                <span title="Phone">Телефон: </span>
                                <a href="tel:{{ exo.phone_mobile }}">{{ exo.phone_mobile }}</a>
                            </p>
                            <p class="card-text">
                                <span title="Phone">Телефон ВН: </span>
                                <a href="tel:{{ exo.phone_internal }}">{{ exo.phone_internal }}</a>
                            </p>
                        </div>
                    </div>
                    <div class="text-end">
                        <a v-show="exo.favs==='True'" type="button" class="mt-3"
                           @click="setUserData(exo.email, 0); getUserData()">
                            <i class="h1 bi bi-star-fill"></i>
                        </a>
                        <a v-show="exo.favs==='False'" type="button" class="mt-3"
                           @click="setUserData(exo.email, 1); getUserData()">
                            <i class="h1 bi bi-star"></i>
                        </a>
                    </div>

                </div>
            </div>
        </div>
    </div>

</div>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
    window.onload = function () {
        let tg = window.Telegram.WebApp;
        tg.expand();
        new Vue({
            el: '#app',
            data: {
                query: '',
                u_Data: [],
                set_data: '',
                url: 'https://internalbot.cdtek.ru/api/open/',
                checked: false,
                aria_link: false,
                user_info: []
            },
            mounted() {
                document.title = 'Report'
                this.getUserData()
                this.getUserInfo()
            },
            methods: {
                getUserData() {
                    let par = ''
                    if (this.checked === true)
                        par = 'get_data_favs'
                    else
                        par = 'get_data'
                    axios
                        .post(this.url, {
                                "method": par,
                                "user_id": tg.initDataUnsafe.user.id,
                                "query": this.query,
                            }
                        )
                        .then(response => {
                            this.u_Data = response.data
                            // console.log(this.u_Data)
                        })
                        .catch(error => {
                            console.log(error)
                        })
                },
                setUserData(set_data, params) {
                    axios
                        .post(this.url, {
                                "method": 'set_data',
                                "user_id": tg.initDataUnsafe.user.id,
                                "email": set_data,
                                "params": params
                            }
                        )
                        .then(response => {
                            console.log(response.data)
                            // window.location.reload()
                            document.getUserData()
                        })
                        .catch(error => {
                            console.log(error)
                        })
                },
                getUserInfo() {
                    if (this.aria_link === false)
                        axios
                            .post(this.url, {
                                    "method": 'user_one_info',
                                    "user_id": tg.initDataUnsafe.user.id,
                                }
                            )
                            .then(response => {
                                this.user_info = response.data
                            })
                            .catch(error => {
                                console.log(error)
                            })
                },
            }
        })
    }


</script>
</body>
</html>